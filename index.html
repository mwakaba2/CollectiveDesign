<!DOCTYPE html>
<html lang="en">
	<head>
    	<meta charset="utf-8">
    	<title>Twitch</title>
    	<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
		<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    	<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

		<link rel="stylesheet" href="css/normalize.css">
		<link rel="stylesheet" href="css/styles.css">
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

		<!-- Firebase -->
		<script src='https://cdn.firebase.com/js/client/2.1.0/firebase.js'></script>
  	</head>
	<body>
		<script src= "http://player.twitch.tv/js/embed/v1.js"></script> 
		<script type="text/javascript" src="/pico/client.js"></script>
    	<script type="text/javascript">
        	pico.load('messages');
    	</script>
		<div class="fluid-container">
			<div id="twitchNavBar">
				<a href="/" id="logo">
					<svg class="svg-logo_twitch" height="32px" version="1.1" viewbox="0 0 94 32" width="94px" x="10px" y="0px">
						<path clip-rule="evenodd" d="M88,5h-6V0h-9l-6,5h-5.5L59,7.5V5h-5V0H36v5H16l-5-5H0v22l5,5.25L14,32h6v-1.5l3,1.5h12l2-3l1,3h7v-3l3,3h8l0.5-3l2.5,3h10l3-3v3h4l3-3v3h7l7-6V10L88,5z M13,13H8v6h5v6H6l-4-4V2h6v5h5V13z M36,21.5L32.5,25H15V7h6v12h2V7h6v12h2V7h5V21.5z M44,25h-6V7h6V25z M44,5h-6V2h6V5z M57,13h-5v6h5v6h-7l-4-4V2h6v5h5V13z M72,13h-7v6h7v6h-9l-4-4V11l4-4h9V13z M91,25h-6V13h-5v12h-6V2h6v5h7l4,4V25z" fill-rule="evenodd"></path>
					</svg>
	      		</a>
	      		<h4>Channels</h4>
	      		<h4 id="message"></h4>
		      		<select name = "drop_down" id= "dropDownNames">
	                    <option value="None" selected="Selected">Select Name</option>
	                </select>	
			</div>
			<div id="main-column">	
				<div id="video"></div>
			</div>
			<ul id='long-tails'></ul>
		</div>
		
		<script type="text/javascript">
		    var firebaseLink = 'https://j0n89v2391.firebaseio.com/jazzzy_tap';
		    var chats = new Firebase(firebaseLink);
		    var selectedName;
		    var options = {
		        width: 800,
		        height: 500,
		        channel: "jazzy_tap", 
		        //video: "{VIDEO_ID}"       
		    };
		    var player = new Twitch.Player("video", options);
		    player.setVolume(0.5);
		    $(document).ready(function() {
		    	$.getJSON("../json/extracted_streams.json", function(obj) {
            		$.each(obj.streams, function(key, value){
            			$("#dropDownNames").append($('<option></option>').val(value.name).html(value.displayName));	
            		})
        		});

        		$('#dropDownNames').change(function () {
            		selectedName = $(this).val();
            		link = "http://www.twitch.tv/"+selectedName+"/chat";
            		$("#chat").attr("src", link);
            		player.setChannel(selectedName);
       				messages.getCurrentChats(selectedName);
        		});

 				var messageList = $('#long-tails');
		     	// Add a callback that is triggered for each chat message.
				chats.limitToLast(20).on('child_added', function (snapshot) {
					//GET DATA
					var data = snapshot.val();
					var message = data.message;

					//CREATE ELEMENTS MESSAGE & SANITIZE TEXT
					var messageElement = $("<li>");
					messageElement.text(message);

					//ADD MESSAGE
					messageList.append(messageElement)

					//SCROLL TO BOTTOM OF MESSAGE LIST
					messageList[0].scrollTop = messageList[0].scrollHeight;
				});
		    });
		</script> 
	</body>
</html>


